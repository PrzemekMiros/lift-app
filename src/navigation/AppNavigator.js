import React, { useMemo, useRef } from 'react';
import { View, Text, StyleSheet, ScrollView, Pressable, Platform } from 'react-native';
import Svg, { Path, Circle, Rect } from 'react-native-svg';
import colors from '../constants/colors';

const MENU_ITEMS = [
  { key: 'workouts', label: 'Treningi', icon: WorkoutsIcon },
  { key: 'library', label: 'Baza cwiczen', icon: LibraryIcon },
  { key: 'history', label: 'Historia', icon: HistoryIcon },
  { key: 'timers', label: 'Timery', icon: TimerIcon },
  { key: 'metrics', label: 'Metryki ciala', icon: MetricsIcon },
  { key: 'stats', label: 'Statystyki', icon: StatsIcon },
];

function WorkoutsIcon({ color }) {
  return (
    <Svg width={24} height={24} viewBox="0 0 24 24" fill="none">
      <Rect x="2" y="9" width="4" height="6" rx="1.5" fill={color} />
      <Rect x="18" y="9" width="4" height="6" rx="1.5" fill={color} />
      <Rect x="6" y="10" width="12" height="4" rx="2" fill={color} />
    </Svg>
  );
}

function LibraryIcon({ color }) {
  return (
    <Svg width={24} height={24} viewBox="0 0 24 24" fill="none">
      <Rect x="3" y="4" width="6" height="16" rx="1.5" fill={color} />
      <Rect x="10" y="6" width="4" height="14" rx="1.5" fill={color} />
      <Rect x="15" y="5" width="6" height="15" rx="1.5" fill={color} />
    </Svg>
  );
}

function HistoryIcon({ color }) {
  return (
    <Svg width={24} height={24} viewBox="0 0 24 24" fill="none">
      <Circle cx="12" cy="12" r="8" stroke={color} strokeWidth="2" />
      <Path d="M12 7v5l4 2" stroke={color} strokeWidth="2" strokeLinecap="round" />
    </Svg>
  );
}

function TimerIcon({ color }) {
  return (
    <Svg width={24} height={24} viewBox="0 0 24 24" fill="none">
      <Circle cx="12" cy="13" r="7" stroke={color} strokeWidth="2" />
      <Rect x="9" y="3" width="6" height="3" rx="1" fill={color} />
      <Path d="M12 13l3 2" stroke={color} strokeWidth="2" strokeLinecap="round" />
    </Svg>
  );
}

function MetricsIcon({ color }) {
  return (
    <Svg width={24} height={24} viewBox="0 0 24 24" fill="none">
      <Path d="M7 7c0-2 2-3 5-3s5 1 5 3-2 3-5 3-5-1-5-3Z" fill={color} />
      <Rect x="6" y="10" width="12" height="10" rx="5" fill={color} />
    </Svg>
  );
}

function StatsIcon({ color }) {
  return (
    <Svg width={24} height={24} viewBox="0 0 24 24" fill="none">
      <Rect x="4" y="12" width="3" height="8" rx="1" fill={color} />
      <Rect x="10" y="8" width="3" height="12" rx="1" fill={color} />
      <Rect x="16" y="5" width="3" height="15" rx="1" fill={color} />
    </Svg>
  );
}

function AppLogo() {
  return (
    <Svg width={110} height={110} viewBox="0 0 110 110" fill="none">
      <Path
        d="M99 22H10V88.4819H99V22Z"
        fill="white"
        mask="url(#mask0_4057_33)"
      />
    </Svg>
  );
}

function MenuItem({ label, icon: Icon, active, onPress }) {
  const color = active ? colors.primary : colors.muted;

  return (
    <Pressable style={styles.menuItem} onPress={onPress}>
      <View style={styles.iconWrap}>
        <Icon color={color} />
      </View>
      <Text style={[styles.menuLabel, { color }]} numberOfLines={1}>
        {label}
      </Text>
    </Pressable>
  );
}

export default function AppNavigator() {
  const [activeKey, setActiveKey] = React.useState('workouts');
  const scrollRef = useRef(null);
  const scrollX = useRef(0);
  const activeLabel = useMemo(() => {
    const item = MENU_ITEMS.find((entry) => entry.key === activeKey);
    return item ? item.label : 'Treningi';
  }, [activeKey]);

  const handleScroll = (event) => {
    scrollX.current = event.nativeEvent.contentOffset.x;
  };

  const handleWheel = (event) => {
    if (Platform.OS !== 'web' || !scrollRef.current) {
      return;
    }

    const nextX = Math.max(0, scrollX.current + event.nativeEvent.deltaY);
    scrollRef.current.scrollTo({ x: nextX, animated: false });
  };

  return (
    <View style={styles.container}>
      <View style={styles.logoWrap}>
        <Svg width={110} height={110} viewBox="0 0 110 110" fill="none">
          <Path d="M99 22H10V88.4819H99V22Z" fill="white" />
          <Path d="M18.6289 57.7933C20.2347 58.4956 21.9041 58.7243 23.587 58.4999C25.7758 69.6799 32.3185 77.4257 43.2929 81.913C43.4725 80.9442 43.5642 80.0984 43.7921 79.2873C44.4745 76.8602 45.2053 74.4453 45.9265 72.0282C46.4048 70.4249 46.8591 68.8197 46.9435 67.1411C47.0293 65.4332 46.678 63.8278 45.7598 62.3487C45.0751 61.2456 44.3837 60.1464 43.6902 59.0373C43.0994 59.8172 42.5476 60.6453 41.8905 61.3889C40.9664 62.4348 40.0031 63.4564 38.9764 64.4097C38.5524 64.8034 37.9501 65.0789 37.3772 65.2591C35.9795 65.6988 34.6983 65.1755 34.0275 63.9244C33.082 62.1613 32.5458 60.2763 32.2816 58.3153C31.7368 54.2723 31.1853 50.2299 30.6204 46.1894C30.6021 46.0582 30.4094 45.8465 30.2959 45.8455C28.279 45.8243 26.2617 45.8302 24.1606 45.8302C24.1606 46.0788 24.1607 46.2792 24.1606 46.4794C24.1589 48.805 24.1539 51.1306 24.1575 53.4562C24.1586 54.1558 23.9196 54.7534 23.363 55.2124C22.6412 55.8074 21.8141 55.9929 20.9288 55.6158C20.0362 55.2356 19.5567 54.5471 19.5469 53.604C19.5312 52.0942 19.5309 50.5843 19.532 49.0744C19.5353 44.5968 19.5421 40.1192 19.5485 35.6417C19.549 35.2946 19.5393 34.9464 19.5654 34.6008C19.6617 33.3245 20.6414 32.4524 21.9231 32.4877C23.1823 32.5224 24.1514 33.4706 24.1602 34.7327C24.1777 37.2666 24.1686 39.8005 24.1705 42.3344C24.1706 42.5058 24.1705 42.6771 24.1705 42.8808C24.3223 42.895 24.443 42.9161 24.5638 42.9161C26.6209 42.9155 28.6782 42.9062 30.7354 42.9155C31.079 42.9169 31.303 42.8358 31.4752 42.5285C31.8166 41.9192 32.4101 41.6729 33.1073 41.6591C33.9807 41.6418 34.855 41.6399 35.7286 41.654C36.414 41.6652 36.9813 41.9408 37.2953 42.5297C37.4797 42.8757 37.7262 42.9241 38.0782 42.9226C40.4778 42.9131 42.8776 42.9177 45.2773 42.9177C45.295 42.9652 45.3128 43.0127 45.3305 43.0603C44.4788 43.3846 43.6459 43.7688 42.7709 44.0187C41.5219 44.3753 40.338 44.8032 39.2917 45.5821C38.9906 45.8062 38.4737 45.8004 38.0504 45.8307C37.7265 45.8538 37.5403 45.9258 37.3886 46.23C36.8925 47.2243 36.0174 47.8702 34.966 48.4267C35.4678 49.8881 35.9679 51.345 36.4681 52.8017C37.1894 49.7599 39.0043 47.6512 42.0709 46.4588C42.0932 46.8467 42.108 47.1707 42.1308 47.4942C42.2991 49.8812 43.6164 51.6573 45.4885 53.1062C46.1477 53.6164 46.8686 54.0876 47.6318 54.4361C50.5518 55.7695 52.1379 58.0707 52.7624 60.9758C53.1104 62.5944 53.2613 64.2753 53.2795 65.9303C53.3424 71.6395 53.3077 77.3498 53.3101 83.0596C53.3101 83.266 53.3101 83.4725 53.3101 83.7323C54.1249 83.7323 54.8935 83.7323 55.7193 83.7323C55.7311 83.504 55.7517 83.2861 55.752 83.0683C55.7571 76.994 55.7497 70.9196 55.7691 64.8453C55.7762 62.6194 56.196 60.4654 57.193 58.4318C58.007 56.7711 59.2436 55.5047 60.9648 54.6683C62.2985 54.0199 63.5628 53.2813 64.6007 52.2204C66.1083 50.6791 66.9542 48.9019 66.8867 46.7681C66.8847 46.7005 66.9011 46.6325 66.9155 46.5073C70.0253 47.635 71.8278 49.761 72.5715 52.8258C73.0594 51.3838 73.5472 49.9417 74.0466 48.4654C73.836 48.3367 73.658 48.2234 73.4756 48.117C72.6804 47.6526 72.0353 47.0501 71.6603 46.2279C71.5118 45.9025 71.2992 45.7665 70.9466 45.8171C70.3062 45.909 69.8167 45.6197 69.2779 45.3345C68.4443 44.8934 67.5453 44.5593 66.6586 44.216C65.7066 43.8475 64.7369 43.5207 63.7749 43.1758C63.7887 43.1156 63.8023 43.0552 63.816 42.995C63.9431 42.9797 64.07 42.952 64.1971 42.9511C66.4726 42.9347 68.7481 42.9175 71.0237 42.9128C71.3419 42.9121 71.5388 42.8544 71.6956 42.5412C71.9976 41.9386 72.58 41.6789 73.2584 41.6623C74.1862 41.6397 75.1153 41.641 76.0433 41.6592C76.7229 41.6725 77.1799 42.0469 77.5459 42.5663C77.6505 42.7148 77.8542 42.8967 78.0141 42.8983C80.2878 42.9198 82.5619 42.9129 84.9282 42.9129C84.9282 42.6543 84.9283 42.4367 84.9282 42.219C84.9268 39.7893 84.9232 37.3596 84.9249 34.9297C84.926 33.4712 85.8326 32.5133 87.227 32.4868C88.532 32.4619 89.5581 33.5115 89.5685 34.9307C89.5841 37.0653 89.5705 39.2001 89.5698 41.3348C89.5687 45.2744 89.5596 49.214 89.5728 53.1535C89.5764 54.2571 89.2137 55.1298 88.0971 55.5941C86.6112 56.2122 84.9878 55.2538 84.9452 53.6946C84.9 52.0469 84.9295 50.3975 84.9275 48.7487C84.9263 47.8129 84.9272 46.8771 84.9272 45.884C82.7319 45.884 80.5813 45.884 78.404 45.884C78.2794 46.9222 78.1746 47.9698 78.0248 49.0116C77.4887 52.7386 76.9917 56.4718 76.3598 60.184C76.1618 61.3466 75.659 62.4811 75.1641 63.5742C74.3346 65.4066 72.4276 65.9257 70.6364 64.8799C70.3441 64.7092 70.0614 64.5057 69.8217 64.273C68.2635 62.761 66.7671 61.1991 65.6183 59.3672C65.5457 59.2515 65.4535 59.1472 65.3424 59.0005C64.5305 60.3542 63.6728 61.6373 62.9676 62.9923C61.7015 65.4249 61.9817 67.9532 62.7029 70.4622C63.4188 72.9529 64.2217 75.421 64.9244 77.9149C65.2771 79.1667 65.4917 80.454 65.7684 81.723C72.3146 79.779 83.1865 71.784 85.273 58.5049C87.0127 58.7172 88.6971 58.4676 90.3193 57.7694C88.912 72.512 75.2755 88.5651 54.4141 88.4826C33.6579 88.4004 19.99 72.79 18.6289 57.7933Z" fill="#D7FB00" />
          <Path d="M60.0068 22.0098C65.5784 22.9284 70.5132 25.0382 75.0179 28.1049C77.128 29.5414 79.0458 31.1861 80.8067 33.0001C81.0932 33.2951 81.236 33.5919 81.2301 34.0139C81.2008 36.0784 81.2116 38.1434 81.2084 40.2082C81.208 40.4093 81.2083 40.6102 81.0907 40.8455C80.8458 40.5349 80.595 40.2283 80.3571 39.9128C76.0639 34.2185 70.5893 30.0128 63.5523 27.765C63.3728 27.7076 63.148 27.4974 63.1206 27.3319C62.7804 25.278 61.8143 23.5611 60.1685 22.1936C60.1293 22.161 60.1004 22.1171 60.0068 22.0098Z" fill="#D7FB00" />
          <Path d="M27.7857 40.7686C27.7857 39.9774 27.7861 39.186 27.7856 38.3947C27.7846 36.851 27.7693 35.307 27.7957 33.7637C27.7999 33.516 27.9266 33.2169 28.1023 33.0331C33.2086 27.6883 39.4783 24.2007 46.8162 22.435C47.5364 22.2616 48.2697 22.1378 48.9523 22C48.6044 22.3629 48.2227 22.731 47.8766 23.1275C46.8402 24.3152 46.22 25.6878 45.9665 27.2079C45.9147 27.5181 45.7982 27.6749 45.4666 27.7753C38.4843 29.8903 33.0045 33.9364 28.7926 39.6039C28.4996 39.9983 28.2075 40.3932 27.9149 40.7878C27.8719 40.7814 27.8287 40.775 27.7857 40.7686Z" fill="#D7FB00" />
          <Path d="M13.5121 42.8141C13.5251 42.5974 13.5492 42.3784 13.5496 42.1594C13.5529 40.3214 13.532 38.4831 13.5583 36.6454C13.5798 35.1516 14.8437 34.2315 16.3715 34.5518C17.3953 34.7665 18.0615 35.5297 18.0674 36.5671C18.0804 38.8906 18.0682 41.2143 18.0682 43.5378C18.0681 46.3817 18.0836 49.2255 18.0658 52.0693C18.0555 53.7267 16.3376 54.7519 14.8033 54.0268C13.9602 53.6283 13.5579 52.9433 13.5561 52.0467C13.5528 50.4167 13.5506 48.7867 13.548 47.1567C13.5477 46.9537 13.548 46.7508 13.548 46.5088C12.9715 46.5088 12.4654 46.5128 11.9595 46.508C10.8353 46.4973 10.0335 45.7514 10.001 44.6913C9.96822 43.6185 10.7107 42.868 11.8796 42.818C12.4033 42.7955 12.9289 42.8141 13.5121 42.8141Z" fill="#D7FB00" />
          <Path d="M95.5119 46.5038C95.5119 48.4085 95.5175 50.2113 95.5097 52.014C95.5053 53.0213 94.9382 53.7692 93.9503 54.1103C92.5472 54.5947 91.0837 53.6877 91.0312 52.2657C90.9928 51.2259 91.0262 50.1836 91.0257 49.1425C91.0234 44.9775 91.0149 40.8127 91.0205 36.6479C91.0227 35.0252 92.4386 34.0913 94.053 34.6254C94.9107 34.9092 95.5057 35.7124 95.5098 36.6257C95.5183 38.4824 95.5156 40.3392 95.5175 42.1961C95.5176 42.3833 95.5175 42.5705 95.5175 42.8088C96.0349 42.8088 96.5012 42.8129 96.9675 42.808C98.1414 42.7957 98.9829 43.5349 99.0017 44.5994C99.02 45.6449 98.1796 46.4711 97.0529 46.5016C96.5667 46.5149 96.0798 46.5038 95.5119 46.5038Z" fill="#D7FB00" />
          <Path d="M58.4548 37.5676C58.4145 36.967 58.4284 36.3465 58.496 35.7071C58.5526 35.1702 58.842 34.654 59.0397 34.1337C59.0702 34.0534 59.183 33.951 59.2633 33.9466C59.7618 33.9191 59.9526 33.5665 60.0792 33.2082C60.3512 32.4375 60.6355 31.6615 60.7877 30.8657C60.853 30.5246 60.7109 30.0328 60.4677 29.7801C60.1155 29.414 60.1562 29.0658 60.1472 28.6464C60.1287 27.7883 60.1947 26.8803 59.9262 26.0848C59.2449 24.0666 57.5968 23.0749 55.4719 22.7203C53.1735 22.3367 50.7255 23.3353 49.576 25.0913C48.7823 26.3036 48.7734 27.6155 48.9124 28.9658C48.9325 29.1619 48.895 29.4583 48.7613 29.5575C48.1977 29.9751 48.1139 30.517 48.2745 31.0987C48.4777 31.8348 48.7157 32.5676 49.019 33.2703C49.1328 33.5339 49.471 33.7102 49.7088 33.9241C49.7955 34.0021 49.9322 34.0573 49.9713 34.1512C50.1921 34.6818 50.5026 35.2073 50.5762 35.7596C50.6626 36.4089 50.6837 37.0493 50.6353 37.6783C52.3124 38.29 55.1144 38.8279 58.4548 37.5676Z" fill="#F2F2F2" />
          <Path d="M65.1826 45.8077C64.1038 45.243 62.972 44.7229 62.0187 43.9972C60.1147 42.548 59.0001 40.7615 58.6002 38.7051C57.286 39.7074 54.8341 40.4872 50.3994 39.0919C50.2 39.8608 49.8835 40.6077 49.4384 41.3259C48.1632 43.3842 46.3423 44.8555 43.9983 45.7052C43.4349 45.9095 43.2943 46.1937 43.3373 46.7467C43.4952 48.7784 44.5191 50.3542 46.0616 51.678C47.1172 52.5838 48.3744 53.1742 49.645 53.7428C50.9533 54.3281 51.9683 55.2189 52.6811 56.4177C52.8437 56.6912 52.9857 56.9758 53.1726 57.3207C53.382 52.6505 53.622 48.0753 53.7646 43.4972C53.7948 42.5241 54.3752 42.1548 55.1638 41.6712C55.4025 46.8667 55.6368 51.9706 55.8781 57.2235C55.993 57.0442 56.0345 56.9916 56.0631 56.9331C56.8262 55.3785 57.9932 54.2267 59.6731 53.5506C60.375 53.2682 61.0682 52.945 61.714 52.5616C64.0367 51.1831 65.5448 49.2983 65.6988 46.5885C65.7228 46.1665 65.5478 45.9989 65.1826 45.8077Z" fill="#F2F2F2" />
          <Path d="M58.6023 38.7063C58.5302 38.3356 58.4815 37.9561 58.4556 37.5684C55.115 38.8286 52.313 38.2908 50.6359 37.679C50.5991 38.1575 50.5217 38.6294 50.4014 39.0931C54.836 40.4882 57.2879 39.7085 58.6023 38.7063Z" fill="#D7FB00" />
        </Svg>
      </View>
      <View style={styles.content}>
        <Text style={styles.title}>{activeLabel}</Text>
        <Text style={styles.subtitle}>Widok roboczy, nawigacja na dole.</Text>
      </View>
      <View style={styles.menuWrapper}>
        <ScrollView
          horizontal
          showsHorizontalScrollIndicator={false}
          contentContainerStyle={styles.menuContent}
          ref={scrollRef}
          onScroll={handleScroll}
          scrollEventThrottle={16}
          onWheel={handleWheel}
        >
          {MENU_ITEMS.map((item) => (
            <MenuItem
              key={item.key}
              label={item.label}
              icon={item.icon}
              active={item.key === activeKey}
              onPress={() => setActiveKey(item.key)}
            />
          ))}
        </ScrollView>
      </View>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: colors.background,
  },
  logoWrap: {
    position: 'absolute',
    top: 12,
    left: 0,
    right: 0,
    alignItems: 'center',
    zIndex: 2,
  },
  content: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    paddingHorizontal: 24,
  },
  title: {
    fontSize: 24,
    color: colors.text,
    fontWeight: '700',
    marginBottom: 8,
  },
  subtitle: {
    fontSize: 14,
    color: colors.muted,
  },
  menuWrapper: {
    borderTopWidth: 1,
    borderTopColor: '#4a445f',
    backgroundColor: colors.surface,
    paddingVertical: 10,
  },
  menuContent: {
    paddingHorizontal: 16,
    paddingRight: 32,
  },
  menuItem: {
    width: 96,
    alignItems: 'center',
    marginRight: 16,
  },
  iconWrap: {
    width: 40,
    height: 40,
    borderRadius: 12,
    backgroundColor: '#2f2a40',
    alignItems: 'center',
    justifyContent: 'center',
    marginBottom: 6,
  },
  menuLabel: {
    fontSize: 12,
    fontWeight: '600',
  },
});
